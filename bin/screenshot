#!/bin/sh

source ~/.config/dotfiles.conf
: '
$screenshot_image_dir
$screenshot_image_temp_dir
'

args=" ${@:2} "
image_name="$(date +%F_%H-%M-%S-%N | cut -c -23).png"

_maim() {
    case $args in
        *" --save "* | *" -s "*)
            image_path="$screenshot_image_dir/$image_name"
            ;;
        *)
            if [ ! -d "$screenshot_image_temp_dir" ]; then
                mkdir "$screenshot_image_temp_dir"
            fi
            image_path="$screenshot_image_temp_dir/$image_name"
    esac

    maim $* $image_path &&
        xclip -selection clipboard -t image/png $image_path
}

case $1 in
    screen)
        _maim
        ;;
    select)
        _maim -su
        ;;
    *)
        echo "Unknown command: $1"
esac
